<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeleTon Mini App</title>
    <link rel="stylesheet" href="style.css">

    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- TonConnect UI -->
    <script src="https://unpkg.com/@tonconnect/ui@2.3.1/dist/tonconnect-ui.min.js"></script>
</head>

<body>

    <div class="container">

        <!-- –õ–û–ì–û -->
        <div class="logo-block">
            <img src="logo.png" alt="TeleTon Logo" class="logo">
        </div>

        <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ç mini app -->
        <p class="description" id="greeting">–ó–∞–≥—Ä—É–∑–∫–∞ TeleTon‚Ä¶</p>

        <!-- –ö–ù–û–ü–ö–ò -->
        <div class="buttons">
            <button class="btn primary" id="btn-connect-wallet">–ü–æ–¥–∫–ª—é—á–∏—Ç—å TON-–∫–æ—à–µ–ª—ë–∫</button>
            <button class="btn secondary" id="btn-create-token">–°–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω</button>
            <button class="btn secondary" id="btn-my-tokens">–ú–æ–∏ —Ç–æ–∫–µ–Ω—ã / –ø—Ä–æ–µ–∫—Ç—ã</button>
        </div>

    </div>

<script>
    const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;

    // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø TON CONNECT UI
    // –í–ê–ñ–ù–û: —Ç—É—Ç —Ç–æ—Ç –∂–µ URL, —á—Ç–æ –≤ tonconnect-manifest.json + /tonconnect-manifest.json
    const tonConnectUI = new TonConnectUI.TonConnectUI({
        manifestUrl: 'https://teleton-miniapp.vercel.app/tonconnect-manifest.json'
    });

    function initTeleTon() {
        const greetingEl = document.getElementById('greeting');
        const btnConnect = document.getElementById('btn-connect-wallet');

        // === Telegram WebApp —á–∞—Å—Ç—å ===
        if (tg) {
            tg.ready();
            tg.expand();

            const user = tg.initDataUnsafe?.user;
            if (user) {
                const name = user.first_name || "–¥—Ä—É–≥";
                greetingEl.textContent = `–ü—Ä–∏–≤–µ—Ç, ${name}! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ TeleTon Token Factory üëã`;
            } else {
                greetingEl.textContent = "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ TeleTon Token Factory üëã";
            }

            const theme = tg.colorScheme; // light / dark
            document.body.dataset.theme = theme;
        } else {
            greetingEl.textContent = "TeleTon Mini App (—Ä–µ–∂–∏–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–Ω–µ Telegram)";
        }

        // === –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å—Ç–∞—Ç—É—Å TON-–∫–æ—à–µ–ª—å–∫–∞ ===
        tonConnectUI.onStatusChange((wallet) => {
            if (wallet) {
                // –ø–æ–¥–∫–ª—é—á–µ–Ω
                const address = wallet.account.address;
                const short = address.slice(0, 4) + "..." + address.slice(-4);
                btnConnect.textContent = `–ö–æ—à–µ–ª—ë–∫: ${short}`;
                btnConnect.classList.add('connected');
            } else {
                // –æ—Ç–∫–ª—é—á–µ–Ω
                btnConnect.textContent = "–ü–æ–¥–∫–ª—é—á–∏—Ç—å TON-–∫–æ—à–µ–ª—ë–∫";
                btnConnect.classList.remove('connected');
            }
        });

        // === –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥–∫–ª—é—á–∏—Ç—å TON-–∫–æ—à–µ–ª—ë–∫" ===
        btnConnect.addEventListener('click', async () => {
            try {
                await tonConnectUI.openModal(); // –æ—Ç–∫—Ä–æ–µ—Ç –º–æ–¥–∞–ª —Å –≤—ã–±–æ—Ä–æ–º –∫–æ—à–µ–ª—å–∫–∞
            } catch (e) {
                if (tg) {
                    tg.showAlert("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞ üòî");
                } else {
                    alert("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞ üòî");
                }
            }
        });

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –ø–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∏
        document.getElementById('btn-create-token').addEventListener('click', () => {
            if (tg) tg.showAlert("–≠–∫—Ä–∞–Ω —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –¥–æ–±–∞–≤–∏–º —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º üòâ");
            else alert("–≠–∫—Ä–∞–Ω —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –¥–æ–±–∞–≤–∏–º —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º üòâ");
        });

        document.getElementById('btn-my-tokens').addEventListener('click', () => {
            if (tg) tg.showAlert("–ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å–ø–∏—Å–æ–∫ —Ç–≤–æ–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤ –∏ –ø—Ä–æ–µ–∫—Ç–æ–≤ üìä");
            else alert("–ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å–ø–∏—Å–æ–∫ —Ç–≤–æ–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤ –∏ –ø—Ä–æ–µ–∫—Ç–æ–≤ üìä");
        });
    }

    document.addEventListener('DOMContentLoaded', initTeleTon);
</script>


</body>
</html>

