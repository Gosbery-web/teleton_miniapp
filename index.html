<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeleTon Mini App</title>
    <link rel="stylesheet" href="style.css">

    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- TonConnect UI -->
    <script src="https://unpkg.com/@tonconnect/ui@2.3.1/dist/tonconnect-ui.min.js"></script>
</head>
<body>

    <div class="container">

        <!-- –õ–û–ì–û -->
        <div class="logo-block">
            <img src="logo.png" alt="TeleTon Logo" class="logo">
        </div>

        <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
        <p class="description" id="greeting">–ó–∞–≥—Ä—É–∑–∫–∞ TeleTon‚Ä¶</p>

        <!-- –ö–ù–û–ü–ö–ò -->
        <div class="buttons">
            <button class="btn primary" id="btn-connect-wallet">–ü–æ–¥–∫–ª—é—á–∏—Ç—å TON-–∫–æ—à–µ–ª—ë–∫</button>
            <button class="btn secondary" id="btn-create-token">–°–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω</button>
            <button class="btn secondary" id="btn-my-tokens">–ú–æ–∏ —Ç–æ–∫–µ–Ω—ã / –ø—Ä–æ–µ–∫—Ç—ã</button>
        </div>

    </div>

    <script>
        // Telegram WebApp –æ–±—ä–µ–∫—Ç (–µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ –≤–Ω—É—Ç—Ä–∏ Telegram)
        const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;

        // TonConnect UI (—á–µ—Ä–µ–∑ CDN)
        let tonConnectUI = null;
        if (window.TON_CONNECT_UI) {
            tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
                manifestUrl: 'https://teleton-miniapp.vercel.app/tonconnect-manifest.json'
            });
        }

        function initTeleTon() {
            const greetingEl = document.getElementById('greeting');
            const btnConnect = document.getElementById('btn-connect-wallet');
            const btnCreate = document.getElementById('btn-create-token');
            const btnMyTokens = document.getElementById('btn-my-tokens');

            // === Telegram WebApp —á–∞—Å—Ç—å ===
            if (tg) {
                tg.ready();
                tg.expand(); // —Ä–∞—Å–∫—Ä—ã—Ç—å mini app –ø–æ –≤—ã—Å–æ—Ç–µ

                const user = tg.initDataUnsafe?.user;
                if (user) {
                    const name = user.first_name || "–¥—Ä—É–≥";
                    greetingEl.textContent = `–ü—Ä–∏–≤–µ—Ç, ${name}! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ TeleTon Token Factory üëã`;
                } else {
                    greetingEl.textContent = "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ TeleTon Token Factory üëã";
                }

                const theme = tg.colorScheme; // "light" –∏–ª–∏ "dark"
                document.body.dataset.theme = theme;
            } else {
                // –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ –Ω–µ –∏–∑ Telegram
                greetingEl.textContent = "TeleTon Mini App (—Ä–µ–∂–∏–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–Ω–µ Telegram)";
            }

            // === –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ—à–µ–ª—å–∫–∞ ===
            if (tonConnectUI) {
                tonConnectUI.onStatusChange((wallet) => {
                    if (wallet) {
                        // –∫–æ—à–µ–ª—ë–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω
                        const address = wallet.account.address;
                        const short = address.slice(0, 4) + "..." + address.slice(-4);
                        btnConnect.textContent = `–ö–æ—à–µ–ª—ë–∫: ${short}`;
                        btnConnect.classList.add('connected');
                    } else {
                        // –∫–æ—à–µ–ª—ë–∫ –æ—Ç–∫–ª—é—á–µ–Ω
                        btnConnect.textContent = "–ü–æ–¥–∫–ª—é—á–∏—Ç—å TON-–∫–æ—à–µ–ª—ë–∫";
                        btnConnect.classList.remove('connected');
                    }
                });
            }

            // === –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥–∫–ª—é—á–∏—Ç—å TON-–∫–æ—à–µ–ª—ë–∫" ===
            btnConnect.addEventListener('click', async () => {
                if (!tonConnectUI) {
                    if (tg) tg.showAlert("TON Connect UI –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è. –ü–æ–ø—Ä–æ–±—É–π –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É üôÉ");
                    else alert("TON Connect UI –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è. –ü–æ–ø—Ä–æ–±—É–π –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É üôÉ");
                    return;
                }

                try {
                    await tonConnectUI.openModal(); // –æ—Ç–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –∫–æ—à–µ–ª—å–∫–∞
                } catch (e) {
                    console.error(e);
                    if (tg) tg.showAlert("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞ üòî");
                    else alert("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞ üòî");
                }
            });

            // === –ö–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω" ===
            btnCreate.addEventListener('click', () => {
                if (tg) {
                    tg.showAlert("–≠–∫—Ä–∞–Ω —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –¥–æ–±–∞–≤–∏–º —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º üòâ");
                } else {
                    alert("–≠–∫—Ä–∞–Ω —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –¥–æ–±–∞–≤–∏–º —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º üòâ");
                }
            });

            // === –ö–Ω–æ–ø–∫–∞ "–ú–æ–∏ —Ç–æ–∫–µ–Ω—ã / –ø—Ä–æ–µ–∫—Ç—ã" ===
            btnMyTokens.addEventListener('click', () => {
                if (tg) {
                    tg.showAlert("–ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å–ø–∏—Å–æ–∫ —Ç–≤–æ–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤ –∏ –ø—Ä–æ–µ–∫—Ç–æ–≤ üìä");
                } else {
                    alert("–ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å–ø–∏—Å–æ–∫ —Ç–≤–æ–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤ –∏ –ø—Ä–æ–µ–∫—Ç–æ–≤ üìä");
                }
            });
        }

        document.addEventListener('DOMContentLoaded', initTeleTon);
    </script>

</body>
</html>
